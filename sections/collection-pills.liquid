{%- assign sid = section.id | replace: '_', '' | downcase -%}

{% style %}
  .cp-grid-{{ sid }}{
    display:flex;
    gap: {{ section.settings.gap }}px;
    flex-wrap:wrap;
    justify-content: {{ section.settings.alignment }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    align-items:center;
  }

  .cp-item-{{ sid }}{
    position:relative;
    width:206px;
    height:100px;
    overflow:hidden;
    border-radius: {{ section.settings.border_radius }}px;
    cursor:pointer;
    transition:transform .3s ease;
  }
  .cp-item-{{ sid }}:hover{ transform: translateY(-2px); }

  .cp-img-{{ sid }}{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
  }

  .cp-ph-{{ sid }}{
    position:absolute; inset:0;
    width:100%; height:100%;
    background: {{ section.settings.placeholder_bg_color }};
  }
  .cp-ph-{{ sid }} svg{ width:100%; height:100%; object-fit:cover; }

  .cp-overlay-{{ sid }}{
    position:absolute; inset:0;
    width:100%; height:100%;
    background: {{ section.settings.overlay_color }};
    opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
  }

  .cp-title-{{ sid }}{
    position:absolute; top:50%; left:50%;
    transform:translate(-50%, -50%);
    font-family:'Montserrat', sans-serif;
    font-weight:700;
    font-size: {{ section.settings.title_size }}px;
    text-transform:uppercase;
    color: {{ section.settings.title_color }};
    text-align:center;
    width:90%;
    z-index:2;
    line-height:1.2;
    letter-spacing:.4px;
  }

  @media (max-width: 749px){
    .cp-grid-{{ sid }}{
      gap: {{ section.settings.gap_mobile }}px;
      justify-content:center;
    }
    .cp-item-{{ sid }}{
      width: calc(50% - {{ section.settings.gap_mobile | divided_by: 2 }}px);
    }
  }

  @media (max-width: 490px){
    .cp-grid-{{ sid }}{
      gap: {{ section.settings.gap_mobile }}px;
      justify-content:center;
      padding: 0 0 40px;
    }
    .cp-item-{{ sid }}{
      width:100%;
      min-width:auto; /* <-- fix: remove 400px lock */
    }
  }
{% endstyle %}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">

<div class="cp-grid-{{ sid }}" {{ section.shopify_attributes }}>
  {% for i in (1..5) %}
    {% liquid
      assign key = 'collection_' | append: i
      assign coll = section.settings[key]
    %}
    {% if coll != blank %}
      <a href="{{ coll.url }}" class="cp-item-{{ sid }}">
        {% if coll.image %}
          <img
            src="{{ coll.image | image_url: width: 412 }}"
            alt="{{ coll.title | escape }}"
            loading="lazy"
            width="206"
            height="100"
            class="cp-img-{{ sid }}"
          >
        {% elsif coll.products.first and coll.products.first.featured_image %}
          <img
            src="{{ coll.products.first.featured_image | image_url: width: 412 }}"
            alt="{{ coll.products.first.title | escape }}"
            loading="lazy"
            width="206"
            height="100"
            class="cp-img-{{ sid }}"
          >
        {% else %}
          <div class="cp-ph-{{ sid }}">{{ 'collection-1' | placeholder_svg_tag }}</div>
        {% endif %}
        <div class="cp-overlay-{{ sid }}"></div>
        <h3 class="cp-title-{{ sid }}">{{ coll.title }}</h3>
      </a>
    {% else %}
      <div class="cp-item-{{ sid }}">
        <div class="cp-ph-{{ sid }}">{{ 'collection-1' | placeholder_svg_tag }}</div>
        <div class="cp-overlay-{{ sid }}"></div>
        <h3 class="cp-title-{{ sid }}">Coleção {{ i }}</h3>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% schema %}
{
  "name": "Collection Pills",
  "settings": [
    { "type": "header", "content": "Collections" },
    { "type": "collection", "id": "collection_1", "label": "Collection 1" },
    { "type": "collection", "id": "collection_2", "label": "Collection 2" },
    { "type": "collection", "id": "collection_3", "label": "Collection 3" },
    { "type": "collection", "id": "collection_4", "label": "Collection 4" },
    { "type": "collection", "id": "collection_5", "label": "Collection 5" },

    { "type": "header", "content": "Layout" },
    {
      "type": "select",
      "id": "alignment",
      "label": "Alignment",
      "options": [
        { "value": "flex-start", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "flex-end", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Gap between items",
      "default": 16
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Gap on mobile",
      "default": 8
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 40
    },

    { "type": "header", "content": "Style" },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 10,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 16
    },
    { "type": "color", "id": "title_color", "label": "Title color", "default": "#FFFFFF" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Overlay opacity",
      "default": 30
    },
    { "type": "color", "id": "placeholder_bg_color", "label": "Placeholder background", "default": "#F4F4F4" }
  ],
  "presets": [{ "name": "Collection Pills" }]
}
{% endschema %}
